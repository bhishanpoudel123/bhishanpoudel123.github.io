<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Locations Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        #map {
            width: 100%;
            height: 600px;
        }
        
        .legend {
            padding: 30px 40px;
            background: #f8f9fa;
        }
        
        .legend h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 1.05em;
        }
        
        .legend-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .home-icon {
            background: #10b981;
        }
        
        .interview-icon {
            background: #3b82f6;
        }
        
        .important-icon {
            background: #f59e0b;
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .leaflet-popup-content {
            margin: 16px;
            font-size: 14px;
            min-width: 250px;
        }
        
        .popup-title {
            font-weight: 700;
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .popup-type {
            color: #666;
            font-size: 13px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .distance-section {
            margin-top: 10px;
        }
        
        .distance-title {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
        }
        
        .distance-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 13px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .distance-item:last-child {
            border-bottom: none;
        }
        
        .distance-city {
            color: #555;
        }
        
        .distance-value {
            font-weight: 600;
            color: #3b82f6;
        }
        
        .distance-label {
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: #10b981;
            border: 2px solid #10b981;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            #map {
                height: 400px;
            }
            
            .legend {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Data Scientist Interview Journey</h1>
            <p>Mapping opportunities across the United States</p>
        </div>
        
        <div id="map"></div>
        
        <div class="legend">
            <h3>Location Key</h3>
            <div class="legend-item">
                <div class="legend-icon home-icon">üè†</div>
                <span><strong>Home Base</strong> - Current location</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon interview-icon">üíº</div>
                <span><strong>Interview Locations</strong> - Final round opportunities</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon important-icon">‚≠ê</div>
                <span><strong>Important Places</strong> - Reference locations</span>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="important_cities.js"></script>
    <script src="cities.js"></script>
    <script>
        // Function to calculate distance between two coordinates (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return Math.round(distance);
        }
        
        // Initialize map centered on USA
        const map = L.map('map').setView([39.8283, -98.5795], 4);
        
        // Add tile layer (map background)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
        // Custom icons
        const homeIcon = L.divIcon({
            className: 'custom-icon',
            html: '<div style="background: #10b981; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üè†</div>',
            iconSize: [40, 40],
            iconAnchor: [20, 20]
        });
        
        const interviewIcon = L.divIcon({
            className: 'custom-icon',
            html: '<div style="background: #3b82f6; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üíº</div>',
            iconSize: [35, 35],
            iconAnchor: [17.5, 17.5]
        });
        
        const importantIcon = L.divIcon({
            className: 'custom-icon',
            html: '<div style="background: #f59e0b; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">‚≠ê</div>',
            iconSize: [35, 35],
            iconAnchor: [17.5, 17.5]
        });
        
        // Find the Home Location (from cities.js) to draw lines from
        const homeLocation = locations.find(loc => loc.type === "home");
        
        // Draw lines from Home Location to all Interview locations (from cities.js)
        locations.forEach(loc => {
            // Only draw lines from home to interview locations
            if (homeLocation && loc.type === 'interview') {
                const distance = calculateDistance(
                    homeLocation.coords[0], homeLocation.coords[1],
                    loc.coords[0], loc.coords[1]
                );
                
                // Draw line
                const line = L.polyline([homeLocation.coords, loc.coords], {
                    color: '#10b981',
                    weight: 2,
                    opacity: 0.6,
                    dashArray: '10, 10'
                }).addTo(map);
                
                // Add distance label at midpoint
                const midLat = (homeLocation.coords[0] + loc.coords[0]) / 2;
                const midLon = (homeLocation.coords[1] + loc.coords[1]) / 2;
                
                const distanceLabel = L.marker([midLat, midLon], {
                    icon: L.divIcon({
                        className: 'distance-label',
                        html: `<div class="distance-label">${distance} mi</div>`,
                        iconSize: [60, 20],
                        iconAnchor: [30, 10]
                    })
                }).addTo(map);
            }
        });
        
        // Add markers for cities.js locations with distances to fixed cities
        locations.forEach(loc => {
            const icon = loc.type === 'home' ? homeIcon : interviewIcon;
            const marker = L.marker(loc.coords, { icon: icon }).addTo(map);
            
            // Calculate distances to all fixed cities AND other cities.js locations
            let distanceHTML = '';
            const distances = [];
            
            // 1. Calculate distances to all fixed cities (always included)
            fixedCities.forEach(fixedCity => {
                const distance = calculateDistance(
                    loc.coords[0], loc.coords[1],
                    fixedCity.coords[0], fixedCity.coords[1]
                );
                distances.push({
                    name: fixedCity.name,
                    short_description: fixedCity.short_description,
                    distance: distance,
                });
            });
            
            // 2. Calculate distances to other locations in cities.js (excluding itself)
            locations.forEach(otherLoc => {
                if (otherLoc.name !== loc.name) {
                    const distance = calculateDistance(
                        loc.coords[0], loc.coords[1],
                        otherLoc.coords[0], otherLoc.coords[1]
                    );
                    distances.push({
                        name: otherLoc.name,
                        short_description: otherLoc.short_description, 
                        distance: distance,
                    });
                }
            });


            // Sort by distance
            distances.sort((a, b) => a.distance - b.distance);
            
            // Build distance HTML (using City Name (Short Description))
            distances.forEach(d => {
                distanceHTML += `
                    <div class="distance-item">
                        <span class="distance-city">${d.name} (${d.short_description})</span>
                        <span class="distance-value">${d.distance} mi</span>
                    </div>
                `;
            });
            
            marker.bindPopup(`
                <div class="popup-title">${loc.name}</div>
                <div class="popup-type">${loc.description}</div>
                <div class="distance-section">
                    <div class="distance-title">üìè Distances to Other Key Locations:</div>
                    ${distanceHTML}
                </div>
            `, { maxWidth: 300 });
        });
        
        // Add markers for fixed cities (important places)
        fixedCities.forEach(loc => {
            const marker = L.marker(loc.coords, { icon: importantIcon }).addTo(map);
            
            // Calculate distances to all cities.js locations
            let distanceHTML = '';
            const distances = [];
            
            locations.forEach(city => {
                const distance = calculateDistance(
                    loc.coords[0], loc.coords[1],
                    city.coords[0], city.coords[1]
                );
                distances.push({
                    name: city.name,
                    short_description: city.short_description,
                    distance: distance
                });
            });
            
            // Sort by distance
            distances.sort((a, b) => a.distance - b.distance);
            
            // Build distance HTML (using City Name (Short Description))
            distances.forEach(d => {
                distanceHTML += `
                    <div class="distance-item">
                        <span class="distance-city">${d.name} (${d.short_description})</span>
                        <span class="distance-value">${d.distance} mi</span>
                    </div>
                `;
            });
            
            marker.bindPopup(`
                <div class="popup-title">${loc.name}</div>
                <div class="popup-type">${loc.description}</div>
                <div class="distance-section">
                    <div class="distance-title">üìè Distances to Interview Locations:</div>
                    ${distanceHTML}
                </div>
            `, { maxWidth: 300 });
        });
        
        // Fit map to show all markers from both files
        const allCoords = [...locations.map(loc => loc.coords), ...fixedCities.map(loc => loc.coords)];
        const bounds = L.latLngBounds(allCoords);
        map.fitBounds(bounds, { padding: [50, 50] });
    </script>
</body>
</html>